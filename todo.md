- [ ] Cell rendering.
    - [x] Pass cell material data to shader.
        - [x] Create image with 32bits cell material data for each cell material.
        - [x] Pass to cell shader as a texture.
    - [x] Display base cell color.
    	- [x] Cell have a base color.
		- [x] Take base colors from cell material and compile into a color palette texture.
		- [x] Add base cell color (from cell resource) palette to shader.
    - [x] Color value 16
		- [x] Define gamma correct value palette.
		- [x] Add 4 bits modulate to cell data.
		- [x] Add value palette to cell shader.
    - [x] Color modulate 16
        - [x] Define color palette.
        - [x] Add 4 bits modulate to cell data.
        - [x] Apply modulate on cell shader.
    - [x] Add booleant to not apply color in cell material.
    - [x] Check that cell can have color when changing material.
        - [x] set color (gdscript)
        - [x] reaction
        - [x] set cell (gdscript)
        - [x] cpp
    - [x] Color generation (noise/sudoku/texture)
        - [x] Generation type can be set on cell material data.
    - [x] Bloom 80%+
        - [x] Add bloom to environment.
    - [ ] Light
        - [x] Add padding to light viewport, so that light does not pop-in
        - [x] Take cell data that can be seen + padding
        - [x] convert cell data to color
        - [x] raycast global light
            - [x] Raycast toward global light origin
            - [x] Can disable (eg. when no sun/moon or too deep)
        - [ ] raycast light
            - [ ] only update if affected chunks changed or light moved.
        - [x] global light
            - [x] Can set strenght
            - [x] Take color and add light if we can see bg
            - [x] Can disable (eg. when no sun/moon or too deep)
    - [x] Merge color pass with global light pass.
    - [ ] Backgroud cells
        - [ ] data: 8 bg color, 3 wire, 1 actuator, 12 actuated tile, 8 actuated tile color/value
        - [ ] only alocate a chunk if there is any
    - [ ] last color bit is transparency (20%)
    - [x] Draw cells & lights above layer 0. 
- [ ] World gen.
    - [x] Can configure infinite border cells material.
    - [x] Figure out gdscript interface.
    - [ ] Generation passes
        - [ ] Carvern
            - [x] Large cave
            - [ ] Snaking tunnel
        - [x] Ocean
        - [ ] Desert
        - [ ] Pyramid
        - [ ] Ice
        - [ ] Bedrock
        - [ ] Hell
        - [ ] Tower
        - [ ] Sky islands
        - [ ] Surface plateau
        - [ ] Mountain
        - [ ] Slime pit
        - [ ] Mushroom cavern
    - [x] Post generation
        - [x] Add set_cell_generation(x, y, mat) to gdscript which can set border cells and skip activation
        - [x] Take border cell from cells's border.
        - [x] Activate all
        - [x] Paint all
        - [x] Simulate for 3k-10k ticks for cells to settle 
    - [x] Add layer height to some global state.
- [x] Border cells.
    - [x] Looping infinite border.
    - [x] Reapply border cell when border is modified.
- [x] Benchmark
- [ ] Simulation
    - [ ] Run without blocking main thread.
    - [x] Run using multiple thread.
    - [ ] If too many active chunk, only update those close to the player.
    - [x] Consider storing ractions in hashmap.
    - [x] Refactor cell movement.
    - [x] Activate rows manualy when setting cells.
- [ ] Character
    - [ ] Fix character going slightly down just before going up for some reason.
    - [ ] Animation template
    - [ ] Player
        - [ ] Hands
            - [ ] Show current item.
            - [ ] Look where the player is aiming
            - [ ] Item use animations.
                - [ ] Melee attack
                - [ ] Mining
                - [ ] Consume item
    - [ ] Enemies
        - [ ] Spawn based on player biome.
        - [ ] Ai templates
    - [ ] Bosses
- [ ] Items
    - [ ] Player inventory
        - [ ] Chest
        - [ ] Equiped armor/accessories
            - [ ] Change sprite
    - [ ] Dropped item
        - [ ] Picked-up if enough space & nearby
        - [ ] Merge same item nearby
        - [ ] Delete if > than a configurable amount
- [x] Biome
    - [x] Biome condition
        - [x] Min cell coverage needed.
        - [x] Min distance from center.
        - [x] Min depth.
        - [x] Priority over other biome
    - [x] Add biome to cell material.
    - [x] New biome scan node
        - [x] Continuously scan nearby cells. Keep a moving average
        - [x] Emit signal on biome change.
    - [x] Remove biome depth requirement
    - [x] Only cavern + surface layer
    - [x] Add bg to biomes data
        - [x] Background
            - [x] Use layer height to clamp biomes bg position
            - [x] Not affected by light
            - [x] Infinite loop
            - [x] Change based on current biome
                - [x] Seamless transition
            - [x] Add biome background node to biome data. 
            - [x] Add cavern fallback bg
            - [x] Add cavern start texture
            - [x] Add surface color gradient
            - [x] new bg should fade-in as well (so that the bgs overlap does not add to >1.0).